pipeline {
    agent any
    tools { 
      maven 'maven3' 
      }
    environment{
      def mvnHome =  tool name: 'maven3', type: 'maven' 
      def BRANCH_NAME ='GIT_BRANCH'
  }
stages {
      stage('GIT checkout') {
                    steps {
                        script{
                               if (env.GIT_BRANCH.contains('main')) {
                            echo 'Hello from main branch'
                            git branch: 'main', url: 'https://github.com/PandeeswariSubbaiya/Testingjenkins_Repo.git'
                            }
                               else {
                                   echo "Run this stage only if the branch is not main"
                                  git branch: 'release', url: 'https://github.com/PandeeswariSubbaiya/Testingjenkins_Repo.git' 
                               }
                               }
                          }
                        }
    stage('Merge release to main') {
                        steps {
                            script {
                                sh "git checkout main"
                                sh "git merge --no-ff --allow-unrelated-histories release"
                                    }
                                }
                             }
     stage('Push Changes') {
            steps {
                // Push changes to the Git repository
                withCredentials([sshUserPrivateKey(credentialsId: 'git-credentials', keyFileVariable: 'SSH_KEY', passphraseVariable: '', usernameVariable: '')]) {
                    sh "git config user.name 'PandeeswariSubbaiya'"
                    sh "git config user.email 'pandeeswari1814@gmail.com'"
                    sh '''
                    git remote remove jenkins
                    git remote add jenkins https://github.com/PandeeswariSubbaiya/Testingjenkins_Repo.git
                    ssh -T https://github.com/PandeeswariSubbaiya/Testingjenkins_Repo.git
                    git push jenkins main
                    '''
               }
            }
        }
     }
  }
